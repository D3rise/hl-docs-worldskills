# Инструкция по поднятию сети HyperLedger Fabric с тремя организациями в ней

0. Создать папку проекта

1. Скачать репозиторий HyperLedger Fabric Samples (fabric-samples) через специальный скрипт, указанный в официальной документации в разделе **Getting Started**/**Install Samples, Binaries, and Docker Images**
![Script](assets/screenshot-script.png)
    * Для запуска скрипта зайдите в терминал, перейдите в нужный каталог (**не папка проекта**) с помощью `cd` и введите скрипт, указанный на сайте - он создаст каталог `fabric-samples`

2. Из полученного каталога `fabric-samples` скопируйте в папку с проектом:
    1. `bin`
    2. `test-network/configtx/configtx.yaml`
    3. `test-network/compose/compose-test-net.yaml`
    4. `test-network/compose/compose-ca.yaml`

3. Измените `configtx.yaml` в папке с проектом следующим образом:
   1. Замените строчки:
      * (28) `MSPDir: ../organizations/ordererOrganizations/example.com/msp` на `MSPDir: ./orgs/orderer`
      * (55) `MSPDIR: ../organizations/peerOrganizations/org1.example.com/msp` на `MSPDir: ./orgs/users`
      * (82) `MSPDir: ../organizations/peerOrganizations/org2.example.com/msp` на `MSPDir: ./orgs/shops`

   2. Создать раздел с информацией о Org3 (Bank):
      * Cоздать раздел `- &Org3` после раздела `- &Org2` и вставить туда всё из `- &Org2`
      * Изменить `MSPDir` на `./orgs/bank`

   3. Изменить `ID` в разделах `&Org1`, `&Org2`, `&Org3` на `UsersMSP`, `ShopsMSP`, `BankMSP`
      * Вместо `Org1MSP` ВЕЗДЕ должно быть `UsersMSP`
      * Вместо `Org2MSP` ВЕЗДЕ должно быть `ShopsMSP`
      * Вместо `Org3MSP` ВЕЗДЕ должно быть `BankMSP`

   4. Изменить `Policies` в разделах каждой организации следующим образом:
      1. Вместо

      ```yaml
        Policies:
            Readers:
                Type: Signature
                Rule: "OR('UsersMSP.admin', 'UsersMSP.peer', 'UsersMSP.client')"
            Writers:
                Type: Signature
                Rule: "OR('UsersMSP.admin', 'UsersMSP.client')"
            Admins:
                Type: Signature
                Rule: "OR('UsersMSP.admin')"
            Endorsement:
                Type: Signature
                Rule: "OR('UsersMSP.peer')"

        ```

        Должно быть:

        ```yaml
        Policies:
            Readers:
                Type: Signature
                Rule: "OR('UsersMSP.member')"
            Writers:
                Type: Signature
                Rule: "OR('UsersMSP.member')"
            Admins:
                Type: Signature
                Rule: "OR('UsersMSP.admin')"
            Endorsement:
                Type: Signature
                Rule: "OR('UsersMSP.member')"
        ```

   5. В раздел `Org1` добавить следующий подраздел:

       ```yaml
         AnchorPeers:
              - Host: <IP в локальной сети первого компьютера>
                Port: 9051
         ```

   6. В раздел `Org2` добавить следующий подраздел:

       ```yaml
         AnchorPeers:
              - Host: <IP в локальной сети второго компьютера>
                Port: 9052
         ```

   7. В раздел `Org3` добавить следующий подраздел:

       ```yaml
         AnchorPeers:
              - Host: <IP в локальной сети второго компьютера>
                Port: 9053
         ```

   8. В разделе `OrdererOrg` изменить `OrdererEndpoints` следующим образом:
       1. В подразделе `Addresses` изменить `orderer.example.com:7050` на `<IP в локальной сети первого компьютера>:7050`
          * Пример: `192.168.1.101:7050`

   9. В разделе `Orderer` удалить подраздел `EtcdDraft`
   10. В разделе `Orderer` изменить `OrdererType` на `solo`
   11. В разделе `Orderer` удалить раздел `Addresses`

   12.
